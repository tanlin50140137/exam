<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>分类管理</title>
<link rel="stylesheet" type="text/css" href="<?php echo apth_url('subject/bim/css/bim-css.css');?>" />
<link rel="stylesheet" type="text/css" href="<?php echo apth_url('subject/bim/layer/theme/default/layer.css');?>" />
<script type="text/javascript" src="<?php echo apth_url('subject/bim/js/jquery-1.11.2.min.js');?>"></script>
<script type="text/javascript" src="<?php echo apth_url('subject/bim/js/logins.js');?>"></script>
<script type="text/javascript" src="<?php echo apth_url('subject/bim/layer/layer.js');?>"></script>
</head>
<body>
<div class="key_box">
	<h1><a href="<?php echo apth_url('?act=adminfrom');?>" target="_parent">&lt;&lt;返回首页</a> &nbsp; &nbsp; &nbsp; <input type="button" value="添加分类 " class="cearter_key" onclick="cearter_key();"/></h1>	
</div>
<div class="addfl">
<form id="ify_frm">
	<p>分类名称： <input type="text" name="title" value="" class="ad_fls" id="ad_fls1"/></p>
	<p>分类排序： <input type="text" name="sort" value="0" class="ad_fls" id="ad_fls2" style="width:5.8rem;"/></p>
	<p>
		添加父类：
		<select name="pid" class="ad_fls2">
			<option value="0">添加为顶级类</option>
<?php if(!empty($flRows1)){?>
	<?php foreach( $flRows1 as $k => $v ){?>	
			<option value="<?php echo $v['id'];?>"><?php echo $v['title'];?></option>
	<?php }?>		
<?php }?>
		</select>
	</p>
	<p>分类描述： <input type="text" name="descri" value="" class="ad_fls"/></p>
	<p>分类状态： <label><input type="radio" name="state" value="0" checked="checked"/>显示</label> &nbsp; &nbsp; <label><input type="radio" name="state" value="1"/>隐藏</label></p>
	<div> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <input type="button" value="添加" class="sbm_fl" onclick="sbm_fl();"/></div>
</form>
</div>
<div class="key_tablebox_all">
<table class="key_tablebox">
		<tr>
			<td>序号</td>
			<td>PID</td>
			<td>分类名称</td>
			<td>排序</td>
			<td>创间时间</td>
			<td>状态</td>
			<td>操作</td>
		</tr>
<?php if( !empty( $rows ) ){?>
	<?php foreach( $rows as $k => $v ){?>	
		<tr>
			<td><?php echo ($k+1);?></td>
			<td><?php echo $v['pid'];?></td>
			<td><?php echo $v['title'];?></td>
			<td><?php echo $v['sort'];?></td>
			<td><?php echo date('Y.m.d H:i:s',$v['publitime']);?></td>
			<td><?php echo GetState($v['state']);?></td>
			<td><a href="">修改</a> | <a href="">删除</a></td>
		</tr>
	<?php }?>	
<?php }?>
		<tr>
			<td colspan="7">
			共<?php echo $TotalRows;?>条 &nbsp; &nbsp; 
			当前 <?php echo $page;?>/<?php echo $TotalPage;?> 页  &nbsp; &nbsp; 
			<a href="<?php echo apth_url('?act=getkey&page='.($page-1));?>">上一页</a> &nbsp; | &nbsp; <a href="<?php echo apth_url('?act=getkey&page='.($page+1));?>">下一页</a>  &nbsp; &nbsp; 
			跳转至 <input type="text" id="g"/> 页 <input type="button" value="G" onclick="btn_g();" class="btn_g"/>  &nbsp; &nbsp; 
			<select onchange="SetShwoTotal(this);">
				<option value="10" selected="selected">显示10条</option>
				<option value="20">显示20条</option>
				<option value="30">显示30条</option>
				<option value="50">显示50条</option>
				<option value="100">显示100条</option>
			</select>
			</td>
		</tr>			
</table>
</div>
<script>
function SetShwoTotal(t)
{
	var c = $(t).val();
	$.post('<?php echo apth_url("index.php");?>',{'act':'SetShwoTotal','c':c},function(d){
		alert(d);
	});
}
function btn_g()
{
	var d = $("#g").val();
	if( d != '' )
	{
		location.href="<?php echo apth_url('?act=getkey&page=');?>"+d;
	}	
}
function cearter_key()
{
	$(".addfl").show();
}
function sbm_fl()
{
	var data = $("#ify_frm").serialize();
	
	var title = $("[name='title']").val();
	var sort = $("[name='sort']").val();
	var pid = $("[name='pid']").val();
	var descri = $("[name='descri']").val();
	var state = $("[name='state']").val();
	
	if( title == '' )
	{
		layer.tips('请输入分类名称', '#ad_fls1');
		return false;
	}
	if( sort == '' )
	{
		layer.tips('排序号不能为空，请输入整数。', '#ad_fls2');
		return false;
	}
	
	$.post('<?php echo apth_url("index.php");?>',{'act':'form_sbm','title':title,'sort':sort,'pid':pid,'descri':descri,'state':state},function(data){
			//console.log(data);return false;
			var obj = eval("("+data+")");
			if( obj.error == 0 )
			{
				$("#ify_frm")[0].reset();
				$(".key_tablebox_all").html(obj.txt);
			}
			else
			{
				layer.msg(obj.txt);
			}	
	});
}
</script>
</body>
</html>